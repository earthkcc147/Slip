import os
import json
import getpass
from colorama import Fore, Back, Style, init
from dotenv import load_dotenv
from banners import print_intro, print_logo, print_login
from function.send.disget import smdc, get_current_time, send

# ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô colorama
init(autoreset=True)

# ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå .env
load_dotenv()

# ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• USERS ‡∏à‡∏≤‡∏Å .env
USERS_JSON = os.getenv("USERS")
current_time = get_current_time()

# ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• USERS_JSON ‡πÄ‡∏õ‡πá‡∏ô dictionary
try:
    users_data = json.loads(USERS_JSON)
except json.JSONDecodeError:
    print(Fore.RED + "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• USERS ‡∏à‡∏≤‡∏Å .env ‡πÑ‡∏î‡πâ ‚ùå")
    exit()

def clear_console():
    # ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏î
    if os.name == 'nt':  # Windows
        os.system('cls')
    else:  # Linux ‡∏´‡∏£‡∏∑‡∏≠ macOS ‡∏´‡∏£‡∏∑‡∏≠ Termux
        os.system('clear')


def login():
    print_login()
    print(Fore.CYAN + "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏¥‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå 'exit' ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö")

    username_input = input(Fore.YELLOW + "Username: ")
    if username_input.lower() == 'exit':
        clear_console()
        print(Fore.YELLOW + "‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß üö™")
        exit()

    password_input = getpass.getpass(Fore.YELLOW + "Password: ")
    if password_input.lower() == 'exit':
        clear_console()
        print(Fore.YELLOW + "‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß üö™")
        exit()

    # ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö username ‡πÅ‡∏•‡∏∞ password
    if username_input in users_data and users_data[username_input]["password"] == password_input:
        clear_console()
        print(Fore.GREEN + "‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚úÖ")
        print(Fore.GREEN + "‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö, " + username_input + " üéâ")
        send(username_input)  # ‡πÉ‡∏ä‡πâ username_input ‡πÅ‡∏ó‡∏ô username
        return True
    else:
        print(Fore.RED + "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‚ùå")
        return False